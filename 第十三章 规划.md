# 第十三章 规划
规划技术起源于20世纪60年代，是人工智能的一个重要领域，主要研究如何合理地选取行动或行动序列来完成具体任务。
规划技术的研究有两大任务：①问题描述，如何方便地表示规划问题；②问题求解，如何高效地求解规划问题。
## 基本概念
规划方法一般分为一下三类：
1. 领域限定：针对具体领域专门设计的特定规划方法。
2. 领域无关：不针对具体领域的通用规划方法。
3. 可配置：在领域无关方法的基础上，针对具体问题可以增加控制信息，从而利用问题领域特征使规划更高效。
> 在提到规划时，通常假设行为是瞬时发生或在规定单位时间完成，即在规划时间不需要考虑行动执行需要的时间

人工智能领域通常关注的是更加基本和通用的领域无关和可配置的规划方法，因此下文重点介绍领域无关的规划方法。
规划问题非常复杂，为了简化问题，我们提出一下假设（经典规划的基本假设）：
1. 有限系统
2. 完全可观察
3. 确定性
4. 静态性
5. 状态目标
6. 序列规划
7. 隐含时间
8. 离线规划
利用上述假设，我们可以区分所研究的规划问题，其中经典规划问题就是满足上述所有假设的规划问题。
现实不可避免地具有不确定性，主要体现在：①信息不完全性，即对世界的描述是不可能完全的；②不可预测性，即外部事件的发生是不可预测的；③行动不确定性，即有些行动效果本质上就是不确定的，如投骰子。
这种不确定性使得规划的指心可能对应于多条不同的执行路径，需要规划算法能高效地分析所有动作各种可能的执行结果。通常采取如下两种方式：
1. 重规划：先假设没有意外发生，从而离线规划出一个解；在执行时监控执行过程；一旦出现意外则重规划，此时重规划可以选择重新规划也可以选择修补现有规划。
2. 条件规划：规划时考虑所有可能发生的情况，在策略中处理每种可能的事件。

下面从问题描述和求解两方面分别介绍经典规划和概率规划。

## 经典规划
经典规划的系统时确定的、静态的、有限的、完全可观察的，并且是受限目标和隐藏时间的状态转移系统。
经典规划问题的任务就是在状态转移图中计算一条从初始状态到目标状态的路径。如果已知状态转移图，则用迪杰斯特拉算法可以快速搜索出路径。但规划问题状态空间通常很大，一般无法显式地构造出整个状态转移图。因此，规划算法要避免构造出整个状态转移图分，而是在隐式表达的基础上求解。
经典规划的主要问题有：①如何在不显式枚举的情况下形式化描述系统状态和动作，描述本身要紧凑，同时便于求解；②如何在选定描述的基础上有效地进行解的搜索。
### 经典规划问题描述
对于经典规划问题，我们需要一种通用的描述方法来紧凑地刻画系统状态和行动，并且便于搜索求解。
一般的思路是：用特征来表达单个状态，状态表示为特征特定值的集合；用操作来计算状态转移，操作表示为特征之间的转换关系；对于规划问题的描述，不需显式表示出所有状态，只需给出初始状态，然后通过操作序列计算出状态之间的转移直到达到目标状态。
几种具体的描述方法：
1. 集合描述
2. 经典描述
### 经典规划问题求解
经典规划问题求解方法可以分为状态空间的求解和规划空间的求解。状态空间搜索是在状态转移图中搜索从初始状态到目标状态的一条路景，一般分为：
1. 前向搜索：从初始状态开始，考虑所有可行的行动，进行深度或广度搜索
2. 后向搜索：从目标状态出发，将当前目标还原为回归子目标，知道返回初始状态。
3. 启发式搜索：利用启发式函数进行前向或后向搜索

规划空间搜索算法的一般步骤为：找到现有规划的缺陷，从中选择一个缺陷，找到解决这一缺陷的所有方法；从中选择一个方法，按次方法对规划求精，直到规划可行。
相比于状态空间的求解，规划空间的求解有如下特点：①状态空间有限，而规划空间无限，但规划空间规划通常由较小的搜索空间；⑤状态空间有显式的中间状态，而规划空间没有明确的状态概念；③规划空间将对动作的选择及顺序分离。

## 概率规划
面对现实中的规划问题，主体对环境特性的把握常常是不完整的，正是由于这种知识的缺失，造成了不确定性。马尔可夫决策模型可以处理这类问题。
马尔可夫决策过程使用的系统有三大特点：一是状态转移的无后效性；二是状态转移可以有不确定性；三是系统所处的每步状态完全可以观察。
### 概率规划问题描述
马尔可夫决策过程最基本的模型是一个由状态、行动、状态转移函数和报酬函数组成的四元组。其中，状态集合表示问题所有可能世界状态的集合；行动集合表示问题所有可能行动的集合；状态转移函数表示在某个状态执行某个动作所能得到的立即报酬。
在马尔可夫决策模型下，系统与问题对应的环境进行交互，即系统在环境中执行一个行动，获知环境所处的新的当前状态，同时获得此次行动的立即收益。

马尔可夫决策过程中的一些概念：
1. 状态
	状态是在某一时间点对该世界或系统的描述。在不同的应用中，人们对状态的定义不一样，一般来说，。在马尔可夫决策过程中定义的状态必须包括所有当前世界中系统能够掌握利用、会对系统决策产生影响的信息，这也作为建模过程中某些因素要不要加入问题状态表示的依据。大多数情况，系统对自己所处的当前世界的状态不可能完整认识，因此需要引入概率方法来处理信息的不确定性。
2. 观察
	在实际应用中，系统通常无法直接获得环境状态，因此通常假设一个有限的观察集合，系统观察的选择和对当前状态的感知来自这个集合。由于系统在部分可观察的马尔可夫决策过程中不能保证每步都获得全部的当前状态信息，为了保持过程的马尔可夫性，这里引入信念状态这一概念。信念状态是系统根据观察及历史信息计算得到的一个当前状态对所有世界状态的一个概率分布。
3. 行动
	系统的行动会参与改变当前世界的状态。马尔可夫决策过程的一个关键部分是提供给系统的用于做决策的行动集合。当某一行动被执行，世界状态将会发生改变，即根据已知概率分布转换为另一状态。
4. 状态转移函数
	状态转移函数描述了系统的动态特性：在确定环境下，在某个状态执行动作可以得到一个确定的状态；在随机环境下，在某个状态下执行某一个动作得到的是一个状态的概率分布。
5. 策略表示形式
	马尔可夫决策过程的解通常称为策略，是从状态集合到动作集合的一个映射。按照策略解决问题的一般过程是首先系统要知道当前所处状态，然后执行策略对应的行动并进入下一状态，重复此过程直到问题结束。
### 概率规划问题求解
马尔可夫决策过程将客观世界的动态特性用状态转移来描述，相关算法可以按是否求解全部状态空间进行划分，由此可将概率规划问题的求解分为反向迭代类求解和前向搜索类求解两种。
1. 反向迭代类求解方法
	策略迭代与值迭代是求解马尔可夫决策过程问题的两个最基本的方法，均基于动态规划。
	在策略迭代中，策略显式表示，可以计算得到对应的值函数，然后使用贝尔曼公式改进策略。由于可能的策略数目是有限的，而策略迭代的过程总是在改进当前的策略，算法在经过有限步的迭代后总会收敛于最优策略。
	在值迭代中，策略没有显式表示，整个过程按动态规划的贝尔曼公式不断迭代更新来改进值函数。其中，每次迭代所有状态值函数更新前后的最大差值称为贝尔曼误差。与策略迭代一样，值迭代经过有限步的迭代后都将收敛于最优值。
2. 前向搜索类求解方法
	现实中有些问题不需要求解从所有状态到达目标状态的策略，而是给定从固定的初始状态开始。这类问题使用策略迭代或者值迭代都可以求解，然而这两种解法都没有利用初始状态的相关知识。
